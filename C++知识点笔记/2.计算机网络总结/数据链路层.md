### 数据链路层所处的位置

**主机1**向**主机2**发送数据，下图展示的数据真正流动的路径

当我们专门研究链路层的时候，我们只需要关心链路层即可。于是，**主机1**向**主机2**发送数据时，我们可以认为是从左到右的数据传递。如下图：

![12389f5805352d7ca19af713ae4a0c8](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\12389f5805352d7ca19af713ae4a0c8.png)

**几个概念**

1.链路：网络中两个结点之间的物理通道，双绞线、光纤、微波等（有线、无线）

2.数据链路：网络中两个结点之间的逻辑通道，把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路。

3.帧：链路层的协议数据单元

### 数据链路层的作用

功能概述

数据链路层在物理层提供服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层。其主要作用是加强物理层传输原始比特流的功能，向网络层提供高质量的数据传输服务。

对于网络层，由于链路层的存在，而不需要关心物理层具体采用了那种传输介质和通信设备。

1. 封装成帧，透明传输
2. 差错控制(帧错/位错)
3. 流量控制

1. 为网络层提供服务。
2. 链路管理，即连接的建立、维持、释放(用于面向连接的服务)。

### 封装成帧



![封装成帧](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\封装成帧.png)

封装成帧：在一段数据的前后部分添加首部和尾部，这样就构成了-一个帧
**首部和尾部**包含许多的控制信息，他们的一个重要作用:帧定界(确定帧的界限)。
帧同步:接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。
组帧的四种方法: 1.字符计数法 2.字符 (节)填充法 3.零比特填充法 4.违规编码法。

### 透明传输

透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。因此，链路层就“看不见"有什么妨
碍数据传输的东西。当所传数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输是透明的。

1.字符计数法

![字符计数法](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\字符计数法.png)

2.字符填充法

出现头部尾部就进行转义

![字符填充法](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\字符填充法.png)

3.零比特法

出现头部或者尾部的信息就转义，只要有5个1，就填一个0

![零比特法](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\零比特法.png)

4.违规编码

![违规](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\违规.png)

### 差错控制

差错产生的原因

当数据信号从发送端发送到物理线路时，由于物理线路存在噪声，因此数据信号经过物理线路的噪声，到达接收端时，已经是数据+噪声的叠加。这就是差错的来源。

差错控制分为两种不同的策略：

**纠错码：每个传输的分组带上足够的冗余信息，接收端能发现并自动纠正差错。**

**检测码：分组包含能够发现差错的冗余信息，接收端能够发现差错。**

由于纠错码实现比较复杂，检测码虽然不能纠错，但是足够简单，能够检测出差错，**配合重传机制**即可。所以广泛采用检测码。

检测码有循环冗余编码（CRC）等方式

![差错控制](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\差错控制.png)

### 流量控制

较高的发送速度和较低的接收能力的不匹配，会造成传输出错

数据链路层的流量控制与传输层流量控制的区别：

1. 数据链路层的流量控制是**点对点**的，而传输层的流量控制是**端到端**的。

2. **数据链路层**流量控制手段:接收方收不下就不回复确认。

3. **传输层流量**控制手段:接收端给发送端一一个窗口 公告。

流量控制采用的方法：停止等待协议、滑动窗口协议（后退N帧和选择重传）

![流量控制方法](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\流量控制方法.png)

1.停止等待协议

“停止等待”就是每发送完-一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组。

分成三种情况，数据帧丢失/帧出错、ACK丢失、ACK迟到

<img src="C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\停止等待1.png" alt="停止等待1" style="zoom:80%;" />

<img src="C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\停止等待2.png" alt="停止等待2" style="zoom:80%;" />

<img src="C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\停止等待3.png" alt="停止等待3" style="zoom:67%;" />

2.后退N帧

滑动窗口：发送端可以连续发送多个数据帧，维持一组连续的允许发送的帧的序号。

从流量控制的角度出发，发送端连续发送数据帧的数量必然会收到限制： 

（1）接收端的缓冲区可以用于接受新的帧的容量 

（2）接收端处理数据帧的速度 

（3）接收端需要等待重传的帧的数量

累积确认：接收方不必对收到的分组逐个发送确认，而是可以在收到几个分组后，对按序到达的最后一个分组加以确认。

要响应三件事：上层发数据判断窗口是否满、收到一个ack、超时

比如，发送方发送0~7个帧，接收方对第0,2,3,7个帧度发送确认，0就是分别对第0个帧的确认，2对第1,2个帧的确认，3对第3个帧的确认，7对第4,5,6,7个帧的确认。

假如接收方只发送了第3个帧的确认，就说明前面0,1,2,3号帧都被接收方正常接收了，但是后面的四个帧虽然也已经发送了，但是却需要重传，这就称作Go-back-N，也就是gbn（后容退N帧）协议。
在这里实际上是回退4帧。

接收方只能按照顺序接受，无序被丢弃，发送窗口最大为2^n-1，接收窗口为1

<img src="C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\后退N.png" alt="后退N" style="zoom:67%;" />

3.选择重传

接收一个确认一个，加大接收窗口，设置接收缓存，缓存乱序到达的帧

只要是窗口内的帧，来一个接收一个确认一个，乱序的就缓存，窗口内序号最小的帧收到就把现在的一批帧给上层，然后向前滑动，只重新传出错的帧

需要响应三件事：上层调用、确认ACK、超时（每个帧有自己的定时器）

<img src="C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\选择重传.png" alt="选择重传" style="zoom:67%;" />

### 以太网协议

MAC地址：MAC地址(物理地址、硬件地址)，每一个设备都拥有唯一的MAC地址，MAC地址共48位，使用十六进制表示

以太网帧：

![以太网帧](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\以太网帧.png)

MAC地址表：![MAC](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\MAC.png)

以太网协议：在mac地址表中查找，能够完成点对点的通信

![以太网协议](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\以太网协议.png)

![以太网协议2](C:\Users\ZJH\Desktop\课件\计算机网络总结\图片\以太网协议2.png)

